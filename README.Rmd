---
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# ploom

[![CRAN_Status_Badge](https://www.r-pkg.org/badges/version/ploom)](https://cran.r-project.org/package=ploom)
[![Build Status](https://api.travis-ci.com/blakeboswell/ploom.svg?branch=develop)](https://api.travis-ci.com/blakeboswell/ploom)
[![Coverage status](https://codecov.io/gh/blakeboswell/ploom/branch/develop/graph/badge.svg)](https://codecov.io/github/blakeboswell/ploom?branch=develop)
[![lifecycle](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)

<!-- [AppVeyor Build Status]() -->

## Overview

`ploom` provides tools for __memory efficient__ fitting of Linear and Generalized Linear models. Inspired by `biglm`, `ploom` fits models with a bounded memory [algorithm](#acknowledgements) enabling:

- Out-of-memory (OOM) processing capable of fitting __billions__ of observations
- _Fast_ in-memory processing that requires less resources than `lm()` and `glm()`

`ploom` contains functions for iterative processing of in-memory data, data in databases, and data on disk. `ploom` models are compatible with `stats` summary functions, `tidy()` and `glance()`, and implement `predict()` and `resid()` functions for in-memory and OOM data sources.

__See More:__\
[Usage]() and [Vignette]() for a more detailed capability overview\
[Benchmarking]() for comparisons with other commonly used packages


## Installation

```{r, eval = FALSE, message=FALSE}
# development version from GitHub:
# install.packages("devtools")
devtools::install_github("blakeboswell/ploom")
```

## Usage

Models are intialized with a `formula()`; fit to data with calls to `fit()`; and summarized with standard functions such as `tidy()`, `glance()`, and `summary()`.

```{r, eval = TRUE, message=FALSE}
library(ploom)

y <- oomlm(mpg ~ wt + qsec + factor(am))
y <- fit(y, data = mtcars)

tidy(y)

```

#### Fitting over Chunks

Models can be be fit with repeated calls to `fit()` over chunks of data. Each call to `fit()` only needs to allocate memory for the provided chunk, thereby bounding the required memory to chunk size.

The function `oomdata_tbl()` enables iteration over an in-memory `tibble()` or `data.frame()`. When provided to `fit()`, all chunks will iterated over.

```{r, eval = TRUE, message=FALSE}
chunks <- oomdata_tbl(mtcars, chunk_size = 16)
y <- fit(oomlm(mpg ~ wt + qsec + factor(am)), chunks)

glance(y)
```

#### Working with Databases

The function `oomdata_dbi()` enables iteratation over a [`DBI`]() result set. `fit()` will automatically fit the model over all chunks.

```{r, eval = TRUE, message=FALSE}
# connect to database
con    <- DBI::dbConnect(RPostgres::Postgres(), dbname="mtcars")
result <- DBI::dbSendQuery(con, "select mpg, wt, qsec, am from mtcars;")
chunks <- oomdata_dbi(result, chunk_size = 16)

# fit model to all chunks
y <- fit(oomlm(mpg ~ wt + qsec + factor(am)), chunks)
augment(y, data = mtcars)
```

See the articles [NA]() and [NA]() for more on interfacing with databases.

#### Prediction & Residuals

Prediction with `ploom` models is performed with the `predict()` function.  `predict()` provides options for confidence intervals, prediction intervals, and standard error in addition to fit.

```{r, eval = TRUE, message=FALSE}
predict(y, new_data = mtcars, std_error = TRUE, interval = "prediction")
```

`ploom` models do not store the residuals during fitting.  Residuals are accessible on demand with `residuals()`:

```{r, eval = TRUE, message=FALSE}
sum(residuals(y, data = mtcars)^2)
```

Similarly we can use `augment()` but we must provide data.

```{r, eval = TRUE, message=FALSE}
augment(y, data = mtcars, std_error = TRUE)
```

## Alternatives

- [`biglm`](https://cran.r-project.org/web/packages/biglm/index.html)
- [`speedglm`](https://cran.r-project.org/web/packages/speedglm/index.html)

## Acknowledgements

Thanks to:

- Fitting is performed via Alan Millerâ€™s AS274 updating QR factorization algorithm
- [`biglm`](https://cran.r-project.org/web/packages/biglm/index.html)

